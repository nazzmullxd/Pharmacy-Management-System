@model MVC_WEB.Models.ViewModels.ProductCreateViewModel
@{
    ViewData["Title"] = "Add New Product";
}

<div class="page-header">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h1><i class="fas fa-plus-circle text-success"></i> Add New Product</h1>
            <p class="mb-0">Create a new product entry for your pharmacy inventory system</p>
        </div>
        <div class="d-flex gap-2">
            <a asp-action="Index" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left"></i> Back to Products
            </a>
            <a asp-action="Categories" class="btn btn-outline-info">
                <i class="fas fa-tags"></i> Categories
            </a>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <form asp-action="Create" method="post" class="product-form">
            <!-- Basic Information Card -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Basic Information</h5>
                </div>
                <div class="card-body">
                    <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>
                    
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label asp-for="ProductName" class="form-label">
                                <i class="fas fa-pills text-muted me-1"></i>Product Name <span class="text-danger">*</span>
                            </label>
                            <input asp-for="ProductName" class="form-control" placeholder="Enter product name" autofocus />
                            <span asp-validation-for="ProductName" class="text-danger small"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="GenericName" class="form-label">
                                <i class="fas fa-flask text-muted me-1"></i>Generic Name <span class="text-danger">*</span>
                            </label>
                            <input asp-for="GenericName" class="form-control" placeholder="Enter generic name" />
                            <span asp-validation-for="GenericName" class="text-danger small"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="Manufacturer" class="form-label">
                                <i class="fas fa-industry text-muted me-1"></i>Manufacturer <span class="text-danger">*</span>
                            </label>
                            <input asp-for="Manufacturer" class="form-control" placeholder="Enter manufacturer name" />
                            <span asp-validation-for="Manufacturer" class="text-danger small"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="Category" class="form-label">
                                <i class="fas fa-tags text-muted me-1"></i>Category <span class="text-danger">*</span>
                            </label>
                            <select asp-for="Category" class="form-select">
                                <option value="">Select Category</option>
                                @foreach (var category in Model.Categories)
                                {
                                    <option value="@category">@category</option>
                                }
                            </select>
                            <span asp-validation-for="Category" class="text-danger small"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="Barcode" class="form-label">
                                <i class="fas fa-barcode text-muted me-1"></i>Barcode
                            </label>
                            <div class="input-group">
                                <input asp-for="Barcode" class="form-control" placeholder="Scan or enter barcode" />
                                <button type="button" class="btn btn-outline-secondary" onclick="generateBarcode()">
                                    <i class="fas fa-magic"></i> Generate
                                </button>
                            </div>
                            <span asp-validation-for="Barcode" class="text-danger small"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="LowStockThreshold" class="form-label">
                                <i class="fas fa-exclamation-triangle text-warning me-1"></i>Low Stock Threshold
                            </label>
                            <input asp-for="LowStockThreshold" class="form-control" type="number" min="0" />
                            <span asp-validation-for="LowStockThreshold" class="text-danger small"></span>
                        </div>
                        <div class="col-12">
                            <label asp-for="Description" class="form-label">
                                <i class="fas fa-align-left text-muted me-1"></i>Description
                            </label>
                            <textarea asp-for="Description" class="form-control" rows="3" placeholder="Enter product description"></textarea>
                            <span asp-validation-for="Description" class="text-danger small"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pricing Information Card -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-dollar-sign me-2"></i>Pricing Information</h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label asp-for="UnitPrice" class="form-label">
                                Unit Price (Cost) <span class="text-danger">*</span>
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">৳</span>
                                <input asp-for="UnitPrice" class="form-control" type="number" step="0.01" min="0.01" placeholder="0.00" />
                            </div>
                            <span asp-validation-for="UnitPrice" class="text-danger small"></span>
                            <small class="text-muted">Purchase price from supplier</small>
                        </div>
                        <div class="col-md-4">
                            <label asp-for="DefaultRetailPrice" class="form-label">
                                Retail Price <span class="text-danger">*</span>
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">৳</span>
                                <input asp-for="DefaultRetailPrice" class="form-control" type="number" step="0.01" min="0.01" placeholder="0.00" />
                            </div>
                            <span asp-validation-for="DefaultRetailPrice" class="text-danger small"></span>
                            <small class="text-muted">Price for individual sales</small>
                        </div>
                        <div class="col-md-4">
                            <label asp-for="DefaultWholeSalePrice" class="form-label">
                                Wholesale Price <span class="text-danger">*</span>
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">৳</span>
                                <input asp-for="DefaultWholeSalePrice" class="form-control" type="number" step="0.01" min="0.01" placeholder="0.00" />
                            </div>
                            <span asp-validation-for="DefaultWholeSalePrice" class="text-danger small"></span>
                            <small class="text-muted">Price for bulk orders</small>
                        </div>
                    </div>

                    <!-- Profit Margin Calculator -->
                    <div class="mt-4 p-3 bg-light rounded">
                        <h6 class="mb-3"><i class="fas fa-calculator me-2"></i>Profit Margin Preview</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="d-flex justify-content-between">
                                    <span>Retail Profit Margin:</span>
                                    <strong id="retailMargin" class="text-success">0%</strong>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex justify-content-between">
                                    <span>Wholesale Profit Margin:</span>
                                    <strong id="wholesaleMargin" class="text-info">0%</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Status Card -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0"><i class="fas fa-toggle-on me-2"></i>Product Status</h5>
                </div>
                <div class="card-body">
                    <div class="form-check form-switch">
                        <input asp-for="IsActive" class="form-check-input" type="checkbox" role="switch" id="isActiveSwitch" checked />
                        <label class="form-check-label" for="isActiveSwitch">
                            <strong>Product is Active</strong>
                            <p class="text-muted mb-0 small">Active products are visible and available for sale</p>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-save me-1"></i> Create Product
                </button>
                <button type="reset" class="btn btn-outline-secondary">
                    <i class="fas fa-undo me-1"></i> Reset
                </button>
                <a asp-action="Index" class="btn btn-outline-danger">
                    <i class="fas fa-times me-1"></i> Cancel
                </a>
            </div>
        </form>
    </div>

    <div class="col-lg-4">
        <!-- Category Info Card -->
        <div class="card shadow-sm mb-3">
            <div class="card-header bg-info text-white">
                <h6 class="mb-0"><i class="fas fa-tags me-2"></i>Available Categories</h6>
            </div>
            <div class="card-body">
                <div class="d-flex flex-wrap gap-2">
                    @foreach (var category in Model.Categories)
                    {
                        <span class="badge bg-light text-dark">@category</span>
                    }
                </div>
                <hr />
                <a asp-action="Categories" class="btn btn-sm btn-outline-info w-100">
                    <i class="fas fa-plus"></i> Manage Categories
                </a>
            </div>
        </div>

        <!-- Tips Card -->
        <div class="card shadow-sm mb-3">
            <div class="card-header bg-warning text-dark">
                <h6 class="mb-0"><i class="fas fa-lightbulb me-2"></i>Quick Tips</h6>
            </div>
            <div class="card-body">
                <ul class="list-unstyled mb-0">
                    <li class="mb-2">
                        <i class="fas fa-check-circle text-success me-2"></i>
                        <small>Use clear, descriptive product names</small>
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-check-circle text-success me-2"></i>
                        <small>Set accurate pricing for profit margins</small>
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-check-circle text-success me-2"></i>
                        <small>Include barcode for quick scanning</small>
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-check-circle text-success me-2"></i>
                        <small>Set low stock threshold for alerts</small>
                    </li>
                    <li class="mb-0">
                        <i class="fas fa-check-circle text-success me-2"></i>
                        <small>Add description for better search</small>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Stock Notice -->
        <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            <strong>Note:</strong> New products start with 0 stock. Use the Stock Management module to add inventory.
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Generate random barcode
        function generateBarcode() {
            const barcode = 'PRD' + Date.now().toString().slice(-10);
            document.getElementById('Barcode').value = barcode;
        }

        // Calculate profit margins
        function calculateMargins() {
            const unitPrice = parseFloat(document.getElementById('UnitPrice').value) || 0;
            const retailPrice = parseFloat(document.getElementById('DefaultRetailPrice').value) || 0;
            const wholesalePrice = parseFloat(document.getElementById('DefaultWholeSalePrice').value) || 0;

            if (unitPrice > 0) {
                const retailMargin = ((retailPrice - unitPrice) / unitPrice * 100).toFixed(1);
                const wholesaleMargin = ((wholesalePrice - unitPrice) / unitPrice * 100).toFixed(1);

                document.getElementById('retailMargin').textContent = retailMargin + '%';
                document.getElementById('wholesaleMargin').textContent = wholesaleMargin + '%';

                // Color coding
                document.getElementById('retailMargin').className = retailMargin > 0 ? 'text-success' : 'text-danger';
                document.getElementById('wholesaleMargin').className = wholesaleMargin > 0 ? 'text-info' : 'text-danger';
            }
        }

        // Attach event listeners for price inputs
        document.getElementById('UnitPrice').addEventListener('input', calculateMargins);
        document.getElementById('DefaultRetailPrice').addEventListener('input', calculateMargins);
        document.getElementById('DefaultWholeSalePrice').addEventListener('input', calculateMargins);
    </script>
}
