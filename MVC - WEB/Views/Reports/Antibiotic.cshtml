@model MVC_WEB.Models.ViewModels.AntibioticReportViewModel
@{
    ViewData["Title"] = "Antibiotic Register";
}

<div class="container-fluid py-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-1">Antibiotic Register</h1>
            <p class="text-muted mb-0">Regulatory compliance and controlled substance tracking</p>
        </div>
        <a asp-action="Index" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-1"></i> Back to Reports
        </a>
    </div>

    <!-- KPI Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-white-50 mb-1">Total Records</h6>
                            <h3 class="mb-0">@Model.TotalRecords</h3>
                        </div>
                        <i class="bi bi-journal-text fs-1 opacity-50"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-white-50 mb-1">Today's Prescriptions</h6>
                            <h3 class="mb-0">@Model.TodaysPrescriptions</h3>
                        </div>
                        <i class="bi bi-calendar-check fs-1 opacity-50"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-white-50 mb-1">Unique Customers</h6>
                            <h3 class="mb-0">@Model.UniqueCustomers</h3>
                        </div>
                        <i class="bi bi-people fs-1 opacity-50"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-white-50 mb-1">Compliance Rate</h6>
                            <h3 class="mb-0">@Model.ComplianceRate.ToString("N1")%</h3>
                        </div>
                        <i class="bi bi-shield-check fs-1 opacity-50"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0"><i class="bi bi-funnel me-2"></i>Filter Records</h5>
        </div>
        <div class="card-body">
            <form method="get" class="row g-3">
                <div class="col-md-4">
                    <label class="form-label">Date Range</label>
                    <select name="dateFilter" class="form-select">
                        <option value="">All Records</option>
                        <option value="today" selected="@(Model.DateFilter == "today")">Today</option>
                        <option value="week" selected="@(Model.DateFilter == "week")">This Week</option>
                        <option value="month" selected="@(Model.DateFilter == "month")">This Month</option>
                        <option value="quarter" selected="@(Model.DateFilter == "quarter")">This Quarter</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Product</label>
                    <input type="text" name="productFilter" class="form-control" placeholder="Search by product name..." value="@Model.ProductFilter" />
                </div>
                <div class="col-md-4 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary me-2">
                        <i class="bi bi-search me-1"></i> Search
                    </button>
                    <a asp-action="Antibiotic" class="btn btn-outline-secondary">
                        <i class="bi bi-x-circle me-1"></i> Clear
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Antibiotic Log Table -->
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="bi bi-list-ul me-2"></i>Antibiotic Dispensing Log</h5>
            <button class="btn btn-outline-primary btn-sm" onclick="window.print();">
                <i class="bi bi-printer me-1"></i> Print Register
            </button>
        </div>
        <div class="card-body">
            @if (Model.AntibioticLogs != null && Model.AntibioticLogs.Any())
            {
                <div class="table-responsive">
                    <table class="table table-hover table-striped">
                        <thead class="table-dark">
                            <tr>
                                <th>Date</th>
                                <th>Invoice #</th>
                                <th>Product</th>
                                <th>Customer</th>
                                <th class="text-center">Qty</th>
                                <th>Prescription #</th>
                                <th>Doctor</th>
                                <th>Dispensed By</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var log in Model.AntibioticLogs.OrderByDescending(l => l.SaleDate))
                            {
                                <tr>
                                    <td>@log.SaleDate.ToString("MMM dd, yyyy HH:mm")</td>
                                    <td><strong>INV-@log.SaleID</strong></td>
                                    <td>@log.ProductName</td>
                                    <td>@(log.CustomerName ?? "Walk-in")</td>
                                    <td class="text-center">@log.Quantity</td>
                                    <td>
                                        @if (!string.IsNullOrEmpty(log.PrescriptionNumber))
                                        {
                                            <span class="badge bg-success">@log.PrescriptionNumber</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-warning">No Rx</span>
                                        }
                                    </td>
                                    <td>@(log.DoctorName ?? "-")</td>
                                    <td>User #@log.UserID</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="text-center text-muted py-5">
                    <i class="bi bi-clipboard-x fs-1 d-block mb-3"></i>
                    <h5>No Antibiotic Records Found</h5>
                    <p>Antibiotic dispensing records will appear here once transactions are logged.</p>
                    <small class="text-muted">
                        <i class="bi bi-info-circle me-1"></i>
                        Records are automatically created when antibiotics are sold with prescription information.
                    </small>
                </div>
            }
        </div>
    </div>

    <!-- Compliance Notice -->
    <div class="alert alert-info mt-4">
        <div class="d-flex">
            <div class="me-3">
                <i class="bi bi-shield-check fs-3"></i>
            </div>
            <div>
                <h6 class="alert-heading">Regulatory Compliance Notice</h6>
                <p class="mb-0">
                    This register is maintained in compliance with pharmaceutical regulations. 
                    All antibiotic sales must be recorded with valid prescription information. 
                    Records are retained for the statutory period as required by local regulations.
                </p>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Print functionality
        function printRegister() {
            window.print();
        }
    </script>
}
